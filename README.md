# üìò Sourcegraph handbook <a href="https://app.netlify.com/sites/sourcegraph-handbook/deploys"><img alt="Netlify Status" src="https://api.netlify.com/api/v1/badges/4c81a998-33b5-4357-a593-479e21bb10f3/deploy-status" align="right"></a>

The Sourcegraph handbook describes how we (Sourcegraph teammates) work. It‚Äôs publicly visible because we are an [open company](https://handbook.sourcegraph.com/company#open-company).

The handbook is a living document and we expect every teammate to propose improvements, changes, additions, and fixes to keep it continuously up-to-date and accurate.

All content is in [Markdown](https://www.markdownguide.org/getting-started/#what-is-markdown) files under the [üìÅ content](./content) folder.

## :warning: Ongoing migration to Notion.so

We are in the process of moving the handbook over Notion.so. In the original spirit of the handbook, we want most pages to stay publicly accessible.

- If you intend to contribute to the handbook, please instead do so on the Notion corresponding page, or port it if that's not yet done.
- If you maintain a set of pages, please take some time to add the corresponding redirection to the Notion equivalent in [data/notion_migration.yaml].

### Plan

- [x] Set up basic Notion structure
- [x] Port the most important pages
- [] Port the remaining content
- Populate redirections for important pages to their Notion equivalent.
- May 1st: pull request for content change are subject to strict review.
  - Only necessary changes are allowed.
- May 15th: content changes are forbidden, only redirections are accepted.
- May 31th: repository is archived.
- `handbook.sourcegraph.com` is now serving Notion pages.
  - Previously set redirections are ported from the application to Cloudflare page rules.

### Need help editing?

Ask in the [#handbook channel](https://app.slack.com/client/T02FSM7DL/CQ44Y7F4G) (for Sourcegraph team members), and/or [post an issue](https://github.com/sourcegraph/handbook/issues).

## Run or develop locally

### Setup

1. Install [asdf](https://asdf-vm.com/)
1. Run `asdf plugin add nodejs && asdf plugin add pnpm && asdf install`

### Running the website locally

Run:

```sh
pnpm install
pnpm dev
```

Then open [http://localhost:3000](http://localhost:3000) in your web browser.

## Development notes

### Autogenerated content

There are special tokens within some markdown pages (`{{generator:*}}`) that are filled at build time from the YAML files in the [data](./data) folder. The code which does this the filling is in [src/lib/generatedMarkdown.ts], and these are called as part of the markdown pipeline in `src/lib/markdownToHtml.ts`.

### Check links locally

We use [markdown-link-check](https://github.com/tcort/markdown-link-check) for link checking at build time in [the `link-check` GitHub action](.github/workflows/link-check.yml). If you want to run it locally, from the root of the repository you can run this command:

```shell
pnpm check-links
```

This can be slow, so you can also check a single file by running this command, replacing `path_to_file` with the file you want to validate:

```shell
pnpm markdown-link-check <path_to_file>
```

Note that this will also check external links, which the GitHub action ignores. If you wish to ignore those, add `-c .github/workflows/link-check-internal.json` to the command.

### Build

During deployment, the `netlify-build` script gets executed. To simulate the build process, you can run it locally:

```shell
pnpm netlify-build
```

The output will be in the `out` directory.

### Deployment to production

The repository is configured to automatically deploy the `main` branch to production on Netlify.
